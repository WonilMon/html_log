<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Movie</title>
        <style>
            body {
                margin: 10px;
            }

            .box1 {
                width: 400px;
                background: green;
                color: white;
                padding: 15px;
                text-align: center;
            }

            .box2 {
                width: 400px;
                margin-top: 15px;
                text-align: center;
            }

            .box3 {
                width: 400px;
                margin-top: 15px;
                text-align: center;
            }

            #msg {
                border-radius: 5px;
                border: 2px solid #73ad21;
                padding: 10px;
                margin-top: 15px;
                width: 400px;
                height: 200px;
                font-size: 14px;
                text-align: left;
            }
        </style>
    </head>
    <body>
        <form action="" method="get">
            <div class="box1">일별 박스 오피스</div>
            <div class="box2">
                <input type="text" name="txtYear" id="txtYear" size="4" />년
                <!-- select>option{$월}*12 -->
                <select name="selMon" id="selMon">
                    <option value="01">1월</option>
                    <option value="02">2월</option>
                    <option value="03">3월</option>
                    <option value="04">4월</option>
                    <option value="05">5월</option>
                    <option value="06">6월</option>
                    <option value="07">7월</option>
                    <option value="08">8월</option>
                    <option value="09">9월</option>
                    <option value="10">10월</option>
                    <option value="11">11월</option>
                    <option value="12">12월</option>
                </select>
                <!--  select>option[value="$"]{$일}*31 -->
                <select name="selDay" id="selDay">
                    <option value="01">1일</option>
                    <option value="02">2일</option>
                    <option value="03">3일</option>
                    <option value="04">4일</option>
                    <option value="05">5일</option>
                    <option value="06">6일</option>
                    <option value="07">7일</option>
                    <option value="08">8일</option>
                    <option value="09">9일</option>
                    <option value="10">10일</option>
                    <option value="11">11일</option>
                    <option value="12">12일</option>
                    <option value="13">13일</option>
                    <option value="14">14일</option>
                    <option value="15">15일</option>
                    <option value="16">16일</option>
                    <option value="17">17일</option>
                    <option value="18">18일</option>
                    <option value="19">19일</option>
                    <option value="20">20일</option>
                    <option value="21">21일</option>
                    <option value="22">22일</option>
                    <option value="23">23일</option>
                    <option value="24">24일</option>
                    <option value="25">25일</option>
                    <option value="26">26일</option>
                    <option value="27">27일</option>
                    <option value="28">28일</option>
                    <option value="29">29일</option>
                    <option value="30">30일</option>
                    <option value="31">31일</option>
                </select>
                <button type="button" id="btn1">확인</button>
            </div>
            <div id="msg"></div>
            <div class="box3"></div>
        </form>
        <script>
            //오늘 날짜 확인 - 1: 어제날짜 화면에 보여주기
            //년, 월, 일 요소 찾아오기
            const txtYear = document.querySelector('#txtYear');
            const selMon = document.querySelector('#selMon');
            const selDay = document.querySelector('#selDay');

            //박스 오피스 순위 보여줄 영역 가져오기
            const msg = document.querySelector('#msg');
            const box = document.querySelector('.box3');

            function init() {
                const today = new Date(); //오늘날짜

                let year = today.getFullYear();
                let month = today.getMonth() + 1;
                let day = today.getDate() - 1;

                if (month < 10) {
                    month = '0' + month;
                }
                if (day < 10) {
                    day = '0' + day;
                }

                txtYear.value = year;
                selMon.value = month;
                selDay.value = day;
            }
            init();

            document.querySelector('#btn1').addEventListener('click', function () {
                let url =
                    'http://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json?key=25c62a9e7d2ce52387b48550c4f8b051&targetDt=';
                let date = txtYear.value + selMon.value + selDay.value;
                console.log(date);
                url += date;
                console.log(url);

                //데이터 요청
                fetch(url)
                    .then(function (response) {
                        if (!response.ok) {
                            throw new Error('주소를 확인해 주세요');
                        }
                        return response.json();
                    })
                    .then(function (data) {
                        console.log(data);

                        let dailyBoxOffieceList = data.boxOfficeResult.dailyBoxOfficeList;
                        console.log(dailyBoxOffieceList);

                        let str = '';
                        dailyBoxOffieceList.forEach(function (element) {
                            str += element.rank + '위';

                            const rankInten = parseInt(element.rankInten);

                            if (rankInten > 0) {
                                str += '(▲';
                            } else if (rankInten < 0) {
                                str += '(▼';
                            } else {
                                str += '(';
                            }
                            str += element.rankInten + ') : ';

                            str +=
                                "<a href='#' onclick=show(" + element.movieCd + ')>' + element.movieNm + '</a><br />';

                            console.log(str);
                        });
                        msg.innerHTML = str;
                    });
            });
            function show(movieCd) {
                console.log(movieCd);

                let url =
                    'http://www.kobis.or.kr/kobisopenapi/webservice/rest/movie/searchMovieInfo.json?key=f5eef3421c602c6cb7ea224104795888&movieCd=';
                url += movieCd;
                console.log(url);
                let str2 = '';
                fetch(url)
                    .then(function (response) {
                        if (!response.ok) {
                            throw new Error('주소를 확인해 주세요');
                        }
                        return response.json();
                    })
                    .then(function (data) {
                        console.log(data);

                        let info = data.movieInfoResult.movieInfo;
                        console.log(info);

                        const movieNm = info.movieNm;
                        const movieNmEn = info.movieNmEn;
                        const showTm = info.showTm;

                        const directors = info.directors;
                        const director = directors.map((a) => a.peopleNm);

                        const actors = info.actors;
                        const actor = actors.map((b) => b.peopleNm);

                        str2 = `
                            <ul>
                                <li>영화제목 : ${movieNm}</li>
                                <li>영어제목 : ${movieNmEn}</li>
                                <li>상영시간 : ${showTm}분</li>
                                <li>감독 : ${director.join(', ')}</li>
                                <li>출연배우 : ${actor.join(', ')}</li>
                            </ul>
                        `;
                        console.log('str2 : ', str2);
                        box.innerHTML = str2;
                    });
            }
        </script>
    </body>
</html>
